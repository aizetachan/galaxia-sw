<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />

    <title>GALACTIC</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="app-header">
      <h1>GALACTIC</h1>
      <p class="muted">
        Un universo compartido. Cada decisión deja huella y cambia el destino de
        la galaxia.
      </p>
      <span id="server-status" class="badge muted">Server: …</span>
    </header>

    <!-- Tarjeta de bienvenida para invitados (mismo marco que el chat) -->
    <main class="chat-wrap">
      <section id="guest-card" class="chat" hidden>
        <div class="guest-info">
          <h3 class="guest-title">MASTER:</h3>
          <p>
            Bienvenid@ a <strong>Galaxia SW</strong>, un mundo vivo compartido.
            Crea un usuario y un PIN de 4 dígitos para empezar. Cuando inicies sesión,
            el Máster te dará la bienvenida y comenzará la historia.
          </p>
        </div>

        <!-- Reutilizamos tus mismos IDs/clases para no romper nada -->
        <div class="auth-row" style="margin-top:16px">
          <input
            id="auth-username"
            placeholder="Usuario"
            autocomplete="username"
            autocapitalize="none"
            spellcheck="false"
          />
          <input
            id="auth-pin"
            placeholder="PIN (4 dígitos)"
            maxlength="4"
            inputmode="numeric"
            pattern="[0-9]{4}"
            autocomplete="one-time-code"
          />
          <button id="auth-login">Entrar</button>
          <button id="auth-register" class="outline">Crear</button>
          <span id="auth-status" class="muted"></span>
        </div>
      </section>

      <!-- Chat real (se muestra solo cuando hay sesión) -->
      <section id="chat" class="chat"></section>

      <!-- CTA de tirada -->
      <section id="roll-cta" class="roll-cta hidden" aria-live="polite">
        <div class="roll-cta__text">
          <strong id="roll-title">Tirada:</strong>
          <span id="roll-skill">—</span>
          <span id="roll-outcome" class="muted"></span>
        </div>
        <div class="roll-cta__actions">
          <button id="resolve-btn" type="button">Resolver tirada</button>
          <button id="cancel-btn" type="button" class="outline">Cancelar</button>
        </div>
      </section>

      <!-- CTA de confirmación (onboarding) -->
      <section id="confirm-cta" class="roll-cta hidden" aria-live="polite">
        <div class="roll-cta__text">
          <strong id="confirm-title">Confirmación:</strong>
          <span id="confirm-summary">—</span>
        </div>
        <div class="roll-cta__actions">
          <button id="confirm-yes" type="button">Sí</button>
          <button id="confirm-no" type="button" class="outline">No</button>
        </div>
      </section>

      <section class="composer">
        <input
          id="input"
          type="text"
          placeholder="Tu nombre en el HoloNet… (usa /restart para reiniciar)"
        />
        <button id="send">Enviar</button>
      </section>
    </main>

    <!-- Ocultamos el footer por que de momento no lo necesititamos
    <footer class="app-footer">
      <span class="muted">
        /privado o /publico para tu perfil. (texto para indicaciones técnicas)
      </span>
    </footer> -->

    <!-- API base: detect origin automatically -->
    <script>
      window.API_BASE = location.origin + "/api";
    </script>

    <!-- Ping de salud (pinta "Server: OK/FAIL" arriba) -->
    <script>
      (async () => {
        const el = document.getElementById("server-status");
        const trimSlash = (s) => (s || "").replace(/\/+$/, "");
        const base = trimSlash(window.API_BASE) || trimSlash(location.origin);
        const healthUrl = base + "/health";
        try {
          const r = await fetch(healthUrl, { method: "GET" });
          el.textContent = r.ok ? "Server: OK" : "Server: ?";
          el.title = healthUrl;
        } catch {
          el.textContent = "Server: FAIL";
          el.title = healthUrl;
        }
      })();
    </script>

    <!-- App principal -->
    <script type="module" src="./main.js"></script>
  </body>
</html>
