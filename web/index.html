<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no"
    />
    <!-- <meta name="api_base"> apunta a tu API en Vercel -->
    <meta name="api_base" content="/api">

    <title>GALACTIC</title>

    <!-- CSS crítico mínimo para evitar parpadeos durante la carga -->
    <style>
      html.preload body { visibility: hidden; }
      html.ready body { visibility: visible; }
    </style>
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <header class="app-header">
      <h1>GALACTIC</h1>
      <p class="muted">
        Un universo compartido. Cada decisión deja huella y cambia el destino de la galaxia.
      </p>
      <span id="server-status" class="badge muted">Server: …</span>
    </header>

    <main class="chat-wrap">
      <!-- Tarjeta de bienvenida / auth -->
      <section id="guest-card" class="chat" hidden>
        <div class="guest-info">
          <h3 class="guest-title">MASTER:</h3>
          <p>
            Bienvenid@ a <strong>Realverse</strong>, un mundo vivo compartido.
            Crea un usuario y un PIN de 4 dígitos para empezar. Cuando inicies sesión,
            el Máster te dará la bienvenida y comenzará la historia.
          </p>
        </div>

        <div class="auth-row" style="margin-top:16px">
          <input id="auth-username" placeholder="Usuario" autocomplete="username" autocapitalize="none" spellcheck="false" />
          <input id="auth-pin" placeholder="PIN (4 dígitos)" maxlength="4" inputmode="numeric" pattern="[0-9]{4}" autocomplete="one-time-code" />
          <button id="auth-login">Entrar</button>
          <button id="auth-register" class="outline">Crear</button>
          <span id="auth-status" class="muted"></span>
        </div>
      </section>

      <!-- Viewport principal -->
      <div id="main-viewport" class="chat">
        <section id="chat"></section>
      </div>

      <!-- CTA tirada -->
      <section id="roll-cta" class="roll-cta hidden" aria-live="polite">
        <div class="roll-cta__text">
          <strong id="roll-title">Tirada:</strong>
          <span id="roll-skill">—</span>
          <span id="roll-outcome" class="muted"></span>
        </div>
        <div class="roll-cta__actions">
          <button id="resolve-btn" type="button">Resolver tirada</button>
          <button id="cancel-btn" type="button" class="outline">Cancelar</button>
        </div>
      </section>

      <!-- CTA confirmación -->
      <section id="confirm-cta" class="roll-cta hidden" aria-live="polite">
        <div class="roll-cta__text">
          <strong id="confirm-title">Confirmación:</strong>
          <span id="confirm-summary">—</span>
        </div>
        <div class="roll-cta__actions">
          <button id="confirm-yes" type="button">Sí</button>
          <button id="confirm-no" type="button" class="outline">No</button>
        </div>
      </section>

      <section class="composer">
        <input
          id="input"
          type="text"
          placeholder="Tu nombre en el HoloNet… (usa /restart para reiniciar)"
          enterkeyhint="send"
        />
        <button id="send">Enviar</button>
      </section>
    </main>

    <!-- Chequea el estado del servidor antes de cargar main.js -->
    <script type="module">
      import { API_BASE, probeHealth, setServerStatus } from './api.js';
      const r = await probeHealth(API_BASE);
      setServerStatus(r.ok);
    </script>

    <!-- App principal -->
    <script type="module" src="./main.js"></script>
  </body>
</html>
